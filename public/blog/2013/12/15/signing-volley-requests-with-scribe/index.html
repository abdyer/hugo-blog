<!DOCTYPE html>
<!--[if lt IE 7]> <html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
<!--[if IE 7]> <html class="no-js lt-ie9 lt-ie8"> <![endif]-->
<!--[if IE 8]> <html class="no-js lt-ie9"> <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js"> <!--<![endif]-->
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>Signing Volley Requests with Scribe  &middot; </title>
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="HandheldFriendly" content="True">
<meta name="MobileOptimized" content="320">
<meta name="viewport" content="width=device-width, initial-scale=1">


<meta name="description" content="Android developer. Beer &amp; coffee snob. Cultivator of beard. Ich lerne Deutsch." />

<meta name="keywords" content="">

<link rel="author" href="http://plus.google.com/+AndrewDyer">


<meta property="og:title" content="Signing Volley Requests with Scribe  &middot;  ">
<meta property="og:site_name" content=""/>
<meta property="og:url" content="http://andydyer.org/blog/2013/12/15/signing-volley-requests-with-scribe/" />
<meta property="og:locale" content="en-us">


<meta property="og:type" content="article" />
<meta property="og:description" content=""/>
<meta property="og:article:published_time" content="2013-12-15T00:00:00Z" />
<meta property="og:article:modified_time" content="2013-12-15T00:00:00Z" />

  

  
<meta name="twitter:card" content="summary" />
<meta name="twitter:site" content="@dammitandy" />
<meta name="twitter:creator" content="@dammitandy" />
<meta name="twitter:title" content="Signing Volley Requests with Scribe" />
<meta name="twitter:description" content="" />
<meta name="twitter:url" content="http://andydyer.org/blog/2013/12/15/signing-volley-requests-with-scribe/" />
<meta name="twitter:domain" content="http://andydyer.org/">
  

<script type="application/ld+json">
  {
    "@context": "http://schema.org",
    "@type": "Article",
    "headline": "Signing Volley Requests with Scribe",
    "author": {
      "@type": "Person",
      "name": "http://profiles.google.com/+AndrewDyer?rel=author"
    },
    "datePublished": "2013-12-15",
    "description": "",
    "wordCount":  478 
  }
</script>



<link rel="canonical" href="http://andydyer.org/blog/2013/12/15/signing-volley-requests-with-scribe/" />

<link rel="apple-touch-icon-precomposed" sizes="144x144" href="http://andydyer.org/touch-icon-144-precomposed.png">
<link href="http://andydyer.org/favicon.png" rel="icon">

<meta name="generator" content="Hugo 0.15" />

  <!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
<script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
<![endif]-->

<link href='https://fonts.googleapis.com/css?family=Merriweather:300%7CRaleway%7COpen+Sans' rel='stylesheet' type='text/css'>
<link rel="stylesheet" href="http://andydyer.org/css/font-awesome.min.css">
<link rel="stylesheet" href="http://andydyer.org/css/style.css">
<link rel="stylesheet" href="http://andydyer.org/css/custom.css">
<link rel="stylesheet" href="http://andydyer.org/css/highlight/monokai_sublime.css">

  
</head>
<body>
  <main id="main-wrapper" class="container main_wrapper has-sidebar">
    <header id="main-header" class="container main_header">
  <div class="container brand">
  <a href="http://andydyer.org/">
    <img class="gravatar" src="http://www.gravatar.com/avatar/e0ac1256093c733a5d5a26085b90966f?s=120" />
    <h1 class="header center teal-text text-lighten-2"></h1>
  </a>
  <div class="container title h1-like">
  <a class="baselink" href="http://andydyer.org/">
  Andy Dyer

</a>

</div>

  
<div class="container topline">
  
  Android developer. Beer &amp; coffee snob. Cultivator of beard. Ich lerne Deutsch.


</div>


</div>

  <nav class="container nav primary no-print">
  


  

</nav>

<div class="container nav secondary no-print">
  


<a id="contact-link-github" class="contact_link" href="https://github.com/abdyer">
  <span class="fa fa-github-square"></span><span>github</span></a>





<a id="contact-link-linkedin" class="contact_link" href="fr.linkedin.com/in/abdyer">
  <span class="fa fa-linkedin-square"></span><span>linkedin</span></a>



<a id="contact-link-googleplus" class="contact_link" href="https://plus.google.com/u/0/+AndrewDyer">
  <span class="fa fa-google-plus-square"></span><span>google+</span></a>





<a id="contact-link-twitter" class="contact_link" href="https://twitter.com/dammitandy">
  <span class="fa fa-twitter-square"></span><span>twitter</span></a>







</div>


  

</header>


<article id="main-content" class="container main_content single">
  <header class="container hat">
  <h1>Signing Volley Requests with Scribe
</h1>

  <div class="metas">
<time datetime="2013-12-15">15 Dec, 2013</time>


  
  &middot; Read in about 3 min
  &middot; (478 Words)
  <br>
  


</div>

</header>

  <div class="container content">
  <p>When I initially needed to integrate OAuth request signing with <a href="https://android.googlesource.com/platform/frameworks/volley">Volley</a> in my Android app, I used the <a href="https://code.google.com/p/oauth-signpost/">Signpost library</a>. It was fairly straightforward to build a URL, pass it to the Signpost OAuthConsumer, and retrieve a new string with the appropriate OAuth parameters added. Unfortunately, as you can see from the <a href="https://github.com/mttkay/signpost/commits/master">commit history</a>, there has been very little activity over the past year.</p>

<p>Increasingly, I see recommendations for <a href="https://github.com/fernandezpablo85/scribe-java">Scribe</a>. The project is very active and it makes <a href="https://github.com/fernandezpablo85/scribe-java/wiki/getting-started">implementing OAuth request signing</a> as easy as it&rsquo;s likely to get.</p>

<p>At first glance, one big problem integrating Scribe with Volley is that the library is designed to use its own <strong>OAuthRequest</strong> class. Of course, this doesn&rsquo;t jibe with Volley since requests must extend <strong>com.android.volley.Request&lt;T&gt;</strong> to take advantage of the request queue sexiness. Since Java does not have multiple inheritance, my first approach involved an unholy attempt to merge the necessary Scribe request code with my Volley request subclass. While this did familiarize me a bit with the inner workings of Scribe&rsquo;s request signing process, I quickly realized this was a nasty hack.</p>

<p>In the end, I decided to let Scribe&rsquo;s <strong>OAuthRequest</strong> class handle the signing and simply transfer the resulting OAuth parameters to my Volley request.</p>

<p>The general process is as follows:</p>

<ol>
<li>Override the <strong>getUrl()</strong> method in your custom request class.</li>
<li>Translate the Volley request method to the corresponding Scribe <strong>Verb</strong>.</li>
<li>Create an instance of scribe <strong>OAuthRequest</strong> with the base request URL. Then, iterate over the Volley request parameters and add them to the <strong>OAuthRequest</strong> object.</li>
<li>Sign the <strong>OAuthRequest</strong> object using an instance of the Scribe <strong>OAuthService</strong> with your stored token (I stash my <strong>OAuthService</strong> and <strong>Token</strong> instances in my <strong>Application</strong> subclass).</li>
<li>Iterate over the <strong>OAuthRequest</strong> object&rsquo;s OAuth parameters and add them to your Volley request&rsquo;s parameters.</li>
<li>Add the Volley request to the queue as normal.</li>
</ol>

<p>And some code to demonstrate:</p>

<pre><code>package com.example.MyApp;

import com.android.volley.Request;
import com.android.volley.Response;

import org.scribe.model.OAuthRequest;
import org.scribe.model.Token;
import org.scribe.model.Verb;

import java.util.Map;

public class VolleyOAuthRequest&lt;T&gt; extends Request&lt;T&gt; {

    private HashMap&lt;String, String&gt; params;
    private OAuthRequest oAuthRequest;

    public DiscogsOAuthRequest(int method, String path, Response.ErrorListener errorListener) {
        super(method, path, errorListener);
        params = new HashMap&lt;String, String&gt;();
    }

    public void addParameter(String key, String value) {
        params.put(key, value);
    }

    @Override
    protected Map&lt;String, String&gt; getParams() {
      return params;
    }

    @Override
    public String getUrl() {
        if(oAuthRequest == null) {
            buildOAuthRequest();

            for(Map.Entry&lt;String, String&gt; entry : oAuthRequest.getOauthParameters().entrySet()) {
                addParameter(entry.getKey(), entry.getValue());
            }
        }
        return super.getUrl() + getParameterString();
    }

    private void buildOAuthRequest() {
        oAuthRequest = new OAuthRequest(getVerb(), super.getUrl());
        for(Map.Entry&lt;String, String&gt; entry : getParams().entrySet()) {
            oAuthRequest.addQuerystringParameter(entry.getKey(), entry.getValue());
        }
        Token token = MyApp.getOAuthToken();
        MyApp.getOAuthService().signRequest(token, oAuthRequest);
    }

    private Verb getVerb() {
        switch (getMethod()) {
            case Method.GET:
                return Verb.GET;
            case Method.DELETE:
                return Verb.DELETE;
            case Method.POST:
                return Verb.POST;
            case Method.PUT:
                return Verb.PUT;
            default:
                return Verb.GET;
        }
    }

    private String getParameterString() {
        StringBuilder sb = new StringBuilder(&quot;?&quot;);
        Iterator&lt;String&gt; keys = params.keySet().iterator();
        while(keys.hasNext()) {
            String key = keys.next();
            sb.append(String.format(&quot;&amp;%s=%s&quot;, key, params.get(key)));
        }
        return sb.toString();
    }
}
</code></pre>

</div>


  <footer class="container">
  <div class="container navigation no-print">
  <h2>Navigation</h2>
  
  

    
    <a class="prev" href="http://andydyer.org/blog/2013/11/20/techstreet-houston-intro-to-android-programming/" title="TechStreet Houston: Intro to Android Programming">
      Previous
    </a>
    

    
    <a class="next" href="http://andydyer.org/blog/2013/12/22/top-10-albums-of-2013/" title="Top 10 Albums of 2013">
      Next
    </a>
    

  


</div>

  <div class="container comments">
  <h2>Comments</h2>
  

</div>

</footer>

</article>
      <footer id="main-footer" class="container main_footer">
  

  <div class="container nav foot no-print">
  

  <a class="toplink" href="#">back to top</a>

</div>

  <div class="container credits">
  
<div class="container footline">
  

</div>


  
<div class="container copyright">
  
  © 2015 Copyright Andy Dyer


</div>


</div>

</footer>

    </main>
    


<script src="http://andydyer.org/js/highlight.pack.js"></script>
<script>hljs.initHighlightingOnLoad();</script>



<script>
  var _gaq=[['_setAccount','AndrewDyer'],['_trackPageview']];
  (function(d,t){var g=d.createElement(t),s=d.getElementsByTagName(t)[0];
  g.src=('https:'==location.protocol?'//ssl':'//www')+'.google-analytics.com/ga.js';
  s.parentNode.insertBefore(g,s)}(document,'script'));
</script>


    
  </body>
</html>

