<!DOCTYPE html>
<html lang="en-us">
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1.0, user-scalable=no"/>
  <title>Using a Third Party FAB with CoordinatorLayout</title>
  <link href="http://andydyer.org/css/materialize.min.css" type="text/css" rel="stylesheet" media="screen,projection"/>
  <link href="http://andydyer.org/css/style.css" type="text/css" rel="stylesheet" media="screen,projection"/>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/8.6/styles/default.min.css">
  <style type="text/css">
  
    footer.page-footer{background-image: url(http://andydyer.org/images/default.png);}
  
  </style>
</head>
<body>
  <ul id="slide-out" class="side-nav">
    <li><a href="http://andydyer.org"><i class="mdi-action-home left"></i>Home<i class="mdi-hardware-keyboard-arrow-right right"></i></a></li>
    <li><a href="http://andydyer.org/categories"><i class="mdi-action-perm-media left"></i>Categories<i class="mdi-hardware-keyboard-arrow-right right"></i></a></li>
    <li><a href="http://andydyer.org/tags"><i class="mdi-action-loyalty left"></i>Tags<i class="mdi-hardware-keyboard-arrow-right right"></i></a></li>
    <hr>
    <li><a href="http://andydyer.org/bands-ive-seen-live">Bands I've Seen Live</a>
  </ul>
  <div id="index-banner" class="parallax-container">
  <a data-activates="slide-out" class="btn-floating button-collapse" style="top: 5px; left: 5px;"><i class="mdi-navigation-menu"></i></a>
    <div class="section no-pad-bot">
      <div class="container">
        
        <a href="http://andydyer.org/">
          <img class="gravatar" src="http://www.gravatar.com/avatar/e0ac1256093c733a5d5a26085b90966f?s=120" />
          <h1 class="header center teal-text text-lighten-2">Andy Dyer</h1>
        </a>
        <div class="row center">
          <h5 class="header col s12 light">Android developer. Beer &amp; coffee snob. Cultivator of beard. Ich lerne Deutsch.</h5>
        </div>
        <div class="row center">
        
          <a href="https://github.com/abdyer"><img src="http://andydyer.org/images/github2-dreamstale35.png"></a>
        
        
        
          <a href="https://twitter.com/dammitandy"><img src="http://andydyer.org/images/twitter-dreamstale71.png"></a>
        
        
          <a href="https://google.com/+AndrewDyer"><img src="http://andydyer.org/images/gplus48x48.png"></a>
        
        
          <a href="https://www.linkedin.com/in/abdyer"><img src="http://andydyer.org/images/linkedin-dreamstale45.png"></a>
        
          <a href="http://andydyer.org/index.xml"><img src="http://andydyer.org/images/feed-dreamstale27.png"></a>
        </div>
      </div>
    </div>
    <div class="parallax">
    
      <img src="http://andydyer.org/images/default.png">
    
    </div>
  </div>



<div class="container">
  <div class="section">

    <div class="row">
      <div class="col s12">
        <div class="card-panel">
          <h4>Using a Third Party FAB with CoordinatorLayout</h4>
          <p>
          
            
              <a href="http://andydyer.org/categories/android/">Android</a>
            
              <a href="http://andydyer.org/categories/apps/">Apps</a>
            
              <a href="http://andydyer.org/categories/material-design/">Material Design</a>
            
           
          </p>
          <p><p>Before the Design Support Library was announced at Google I/O last month, I had numerous third party libraries in my projects for various elements of Material Design. I&rsquo;ve enjoyed replacing the nav drawer, tabs, and parallax scrolling libraries with their support library counterparts. However, on one of my projects, we needed an expanding floating action button (FAB) similar to the one in <a href="https://play.google.com/store/apps/details?id=com.google.android.apps.inbox">Inbox</a>, which the support library does not currently provide.</p>

<p>I chose <a href="https://github.com/futuresimple/android-floating-action-button">this</a> FAB library since it includes a cool little animation from the plus sign to the &ldquo;X&rdquo; when expanding the menu. I foolishly thought I could just drop this into a CoordinatorLayout in place of the support library&rsquo;s FAB. If you&rsquo;ve checked out Chris Banes&rsquo; excellent <a href="https://github.com/chrisbanes/cheesesquare">Cheesesquare</a> sample, you might have noticed the <code>app:layout_anchor</code> and <code>app:layout_anchorGravity</code> attributes defined on the <code>FloatingActionButton</code> element:</p>

<pre><code class="language-xml">&lt;android.support.design.widget.FloatingActionButton
        android:layout_height=&quot;wrap_content&quot;
        android:layout_width=&quot;wrap_content&quot;
        app:layout_anchor=&quot;@id/appbar&quot;
        app:layout_anchorGravity=&quot;bottom|right|end&quot;
        android:src=&quot;@drawable/ic_discuss&quot;
        android:layout_margin=&quot;@dimen/fab_margin&quot;
        android:clickable=&quot;true&quot;/&gt;
</code></pre>

<p>These two attributes are what tells the enclosing <code>CoordinatorLayout</code> how to position the button and how it should behave when scrolling. To investigate how they are used, I used the good ol&rsquo; <code>⌘+B</code> shortcut to go to the <code>FloatingActionButton</code>&rsquo;s class definition. While the support library is not open source, I was still able to view the decompiled source.</p>

<p>The first thing I noticed is the <code>@DefaultBehavior(FloatingActionButton.Behavior.class)</code> annotation at the top of the class. The <code>FloatingActionButton.Behavior</code> child class provides the <code>Behavior</code> implementation used by <code>CoordinatorLayout</code>. I copied and pasted this inner class into my own subclass of the third party library&rsquo;s <code>FloatingActionsMenu</code> class, updated the generic type, and started resolving the compile errors. It didn&rsquo;t take me long to realize that several package private classes and methods were being called in this code. There are two ways to solve this. One is to copy the decompiled source of these classes into my project, but there is still the <code>AppBarLayout</code>&rsquo;s package private <code>getMinimumHeightForVisibleOverlappingContent()</code> method to deal with. A simpler, yet slightly hackish way to handle this is to just define our class in a <code>android.support.design.widget</code> package.</p>

<p>The last issue specific to this library is that its measured height includes its children, so the FAB is not correctly positioned on the edge of the image and content views. After a bit of experimentation, I solved this by overriding <code>onMeasure()</code>:</p>

<pre><code class="language-java">@Override
protected void onMeasure(int widthMeasureSpec, int heightMeasureSpec) {
    super.onMeasure(widthMeasureSpec, heightMeasureSpec);
    // measured height includes child views, so translate Y to align FAB on view edges
    if (getTranslationY() == 0) {
        View fab = getChildAt(getChildCount() - 1); // last child is the FAB
        int shadowRadius = getResources().getDimensionPixelSize(R.dimen.fab_shadow_radius);
        int offset = (getMeasuredHeight() - fab.getMeasuredHeight() + shadowRadius) / 2;
        ViewCompat.setTranslationY(this, offset);
    }
}
</code></pre>

<p>The <a href="https://github.com/abdyer/cheesesquare/blob/master/app/src/main/java/android/support/design/widget/SupportFloatingActionsMenu.java">source</a> for <code>SupportFloatingActionsMenu</code> is on GitHub in <a href="https://github.com/abdyer/cheesesquare">my Cheesesquare fork</a>. Hopefully we&rsquo;ll see first class support for integrating alternate FAB implementations more cleanly with the support library soon.</p>

<p>Here&rsquo;s a screen shot of the end result:</p>

<p><br/></p>

<p><img src="http://andydyer.org/images/cheesesquare_fab_menu.png" alt="Cheesesquare FAB menu" style="width: 405px; margin-left: auto; margin-right: auto; display: block" /></p>

<p><br/></p>
</p>
          <p>28 Jun 2015
            
          </p>
          
        </div>
      </div>
    </div>

    <div class="row">
      <div class="col s3 m1">
      
        <a class="btn-floating btn-large waves-effect waves-light" href="http://andydyer.org/blog/2016/01/02/top-10-albums-of-2015/"><i class="mdi-navigation-arrow-back"></i></a>
      
      </div>
      <div class="col s6 m10 center">&nbsp</div>
      <div class="col s3 m1">
      
        <a class="btn-floating btn-large waves-effect waves-light" href="http://andydyer.org/blog/2015/06/09/the-time-i-interviewed-at-google/"><i class="mdi-navigation-arrow-forward"></i></a>
      
      </div>
    </div>

  </div>
</div>

  <footer class="page-footer">
    <div class="footer-copyright">
      <div class="container">
      © 2015 Copyright Andy Dyer
      <div class="right">Design <a class="grey-text text-lighten-4" href="http://pdevty.github.io/blog/">pdevty</a></div>
      </div>
    </div>
  </footer>
  <script src="https://code.jquery.com/jquery-2.1.4.min.js"></script>
  <script src="http://andydyer.org/js/materialize.min.js"></script>
  <script src="http://andydyer.org/js/init.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/8.6/highlight.min.js"></script>
  <script>hljs.initHighlightingOnLoad();</script>
  
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
    ga('create', 'UA-48421946-1', 'auto');
    ga('send', 'pageview');
  </script>
  

  </body>
</html>

